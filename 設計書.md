# 服の色管理・コーデ提案Webツール 設計書

## 1. 画面構成

### 1.1 メイン画面（コーデ提案画面）
- **目的**: 今日のコーデを提案・表示する
- **レイアウト**:
  - 上部: 天気情報表示エリア
    - 現在の天気アイコン・天気状況
    - 現在の気温（自動取得）
    - 最高気温・最低気温
    - 都市名表示（位置情報または手動入力）
    - 「天気を更新」ボタン
  - 中部: 条件入力エリア
    - 気温入力（スライダーまたは数値入力、天気APIから自動入力可能）
    - シーン選択（会社／休日）のボタン
    - 「コーデを提案」ボタン
  - 中央: 提案されたコーデ表示エリア
    - 色チップで表示（トップス、ボトムス、アウターなど）
    - 組み合わせの説明テキスト
  - 下部: マイ服棚へのリンク

### 1.2 マイ服棚画面（色管理画面）
- **目的**: 持っている服の色を色チップで管理する
- **レイアウト**:
  - 上部: カテゴリ別タブ（トップス、ボトムス、アウター、小物など）
  - 中央: 色チップ一覧表示エリア
    - グリッド形式で色チップを表示
    - 各色チップに削除ボタン（ホバー時に表示）
  - 下部: 色追加エリア
    - カラーピッカーまたは色選択パレット
    - 「追加」ボタン

### 1.3 ヘッダー（全画面共通）
- アプリ名/ロゴ
- ナビゲーション（メイン画面 ⇔ マイ服棚）

## 2. 必要な機能一覧

### 2.1 色管理機能
- **色の追加**
  - カテゴリ（トップス、ボトムス、アウター、小物など）を選択
  - 色を選択（カラーピッカーまたはプリセットパレット）
  - 色チップとして保存
- **色の削除**
  - 色チップをクリックまたはホバーで削除ボタン表示
  - 確認ダイアログ後、削除
- **色の表示**
  - カテゴリ別に色チップをグリッド表示
  - 色チップは実際の色を表示（視覚的に分かりやすく）

### 2.2 天気自動取得機能
- **位置情報の取得**
  - ブラウザのGeolocation APIで現在地を取得（ユーザー許可が必要）
  - または都市名を手動入力（デフォルト: 大阪）
  - 位置情報をローカルストレージに保存（次回から自動使用）
- **天気API連携**
  - OpenWeather APIを使用して天気情報を取得
  - 取得する情報: 現在の気温、最高気温、最低気温、天気状況、天気アイコン
  - APIキーは環境変数または設定ファイルで管理（フロントエンドではバックエンド経由で取得）
- **自動更新**
  - ページ読み込み時に自動で天気情報を取得
  - 「天気を更新」ボタンで手動更新も可能
  - 取得した気温を気温入力欄に自動入力（ユーザーが手動変更も可能）
- **エラーハンドリング**
  - API取得失敗時は手動入力にフォールバック
  - 位置情報取得拒否時は都市名入力にフォールバック

### 2.3 コーデ提案機能
- **条件入力**
  - 気温入力（-10℃〜40℃程度、スライダー推奨、天気APIから自動入力）
  - シーン選択（会社／休日）
- **提案ロジック**
  - 気温に応じた適切なカテゴリ選択（例: 20℃以下→アウター必須）
  - シーンに応じた色の組み合わせ（会社→落ち着いた色、休日→明るい色など）
  - 色のバランスを考慮した組み合わせ（同系色、補色、無彩色の組み合わせなど）
  - 過去の提案履歴を考慮し、同じ組み合わせを避ける
  - 天気状況も考慮（雨の日は暗めの色、晴れの日は明るい色など）
- **提案表示**
  - 選択された色チップを組み合わせて表示
  - 組み合わせの説明（例: "落ち着いたトーンで統一"）

### 2.4 データ管理機能
- **ローカルストレージ保存**
  - ブラウザのlocalStorageに色データを保存
  - カテゴリ別に色情報を保存（JSON形式）
  - 提案履歴を保存（同じ組み合わせを避けるため）
- **データ読み込み**
  - ページ読み込み時に保存された色データを読み込む
  - 初期状態ではサンプル色を表示

### 2.5 UI/UX機能
- **レスポンシブデザイン**
  - スマートフォン、タブレット、PCに対応
- **直感的な操作**
  - ドラッグ&ドロップでの色追加（オプション）
  - ワンクリックでのコーデ提案
  - 視覚的なフィードバック（アニメーション、色の強調など）
- **アクセシビリティ**
  - 色名のテキスト表示（色覚多様性への配慮）
  - キーボード操作対応

## 3. 技術要件

### 3.1 フロントエンド
- HTML5 / CSS3
- JavaScript (Vanilla JS または 軽量フレームワーク)
- カラーピッカーライブラリ（例: Pickr, Coloris）
- レスポンシブCSS（Flexbox/Grid）
- Geolocation API（位置情報取得）
- Fetch API（天気API呼び出し）

### 3.1.1 バックエンド（天気API連携用）
- **オプション1: サーバーレス関数（推奨）**
  - Vercel Functions、Netlify Functions、AWS Lambdaなど
  - OpenWeather APIキーを環境変数で管理
  - CORS対応
- **オプション2: 簡易バックエンド**
  - Python Flask/FastAPI または Node.js Express
  - OpenWeather APIをプロキシして呼び出し
  - APIキーをサーバー側で管理

### 3.2 データ構造
```javascript
// 色データの構造例
{
  tops: [
    { id: 1, color: "#FF5733", name: "コーラル" },
    { id: 2, color: "#3498DB", name: "ブルー" }
  ],
  bottoms: [
    { id: 1, color: "#2C3E50", name: "ネイビー" }
  ],
  outer: [
    { id: 1, color: "#95A5A6", name: "グレー" }
  ],
  accessories: []
}

// 提案履歴の構造例
{
  history: [
    {
      date: "2024-01-15",
      temperature: 15,
      scene: "会社",
      combination: { tops: 1, bottoms: 1, outer: 1 }
    }
  ]
}

// 位置情報・天気設定の構造例
{
  location: {
    city: "Osaka",
    lat: 34.6937,
    lon: 135.5023,
    lastUpdated: "2024-01-15T08:00:00Z"
  },
  weather: {
    temp: 15.5,
    tempMax: 18.0,
    tempMin: 12.0,
    description: "晴れ",
    icon: "01d",
    lastUpdated: "2024-01-15T08:00:00Z"
  }
}
```

### 3.3 天気API連携の実装
1. **OpenWeather APIの使用**
   - APIエンドポイント: `https://api.openweathermap.org/data/2.5/weather`
   - 必要なパラメータ: `q`（都市名）または`lat`/`lon`（緯度経度）、`appid`（APIキー）
   - レスポンスから気温（ケルビン→摂氏変換）、天気状況、アイコンを取得

2. **位置情報の取得方法**
   - 優先順位1: ブラウザのGeolocation API（ユーザー許可が必要）
   - 優先順位2: ローカルストレージに保存された都市名
   - 優先順位3: デフォルト値（大阪）

3. **APIキーの管理**
   - フロントエンドに直接APIキーを埋め込まない（セキュリティ上の理由）
   - バックエンド経由でAPIを呼び出す、または環境変数で管理

### 3.4 提案アルゴリズムの基本ロジック
1. **気温によるカテゴリ選択**
   - 15℃以下: アウター必須
   - 20℃以上: アウター任意
   - 25℃以上: アウター不要

2. **シーンによる色の選定**
   - 会社: 無彩色、落ち着いた色、ダークトーン優先
   - 休日: 明るい色、パステル、ビビッドカラー可

3. **天気による色の選定**
   - 雨・曇り: 暗めの色、無彩色を推奨
   - 晴れ: 明るい色、ビビッドカラー可
   - 雪: 明るい色（視認性向上）

4. **組み合わせのバランス**
   - 同系色で統一
   - または無彩色＋1色アクセント
   - 補色の組み合わせ（上級者向け）

5. **重複回避**
   - 過去7日間の提案履歴を確認
   - 同じ組み合わせを避ける

## 4. 実装の優先順位

### Phase 1: 基本機能
1. 色チップの表示
2. 色の追加・削除
3. ローカルストレージへの保存・読み込み

### Phase 2: 天気自動取得機能
1. 位置情報取得機能（Geolocation API）
2. 天気API連携（バックエンドまたはサーバーレス関数）
3. 天気情報の表示UI
4. 気温の自動入力機能

### Phase 3: コーデ提案機能
1. 条件入力UI
2. 基本的な提案ロジック
3. 提案結果の表示
4. 天気状況を考慮した提案ロジック

### Phase 4: 改善機能
1. 提案履歴の管理
2. 重複回避ロジック
3. UI/UXの改善（アニメーション、レスポンシブ対応）
4. 天気情報のキャッシュ機能（API呼び出し回数削減）

## 5. 画面遷移図

```
[メイン画面（コーデ提案）]
    ↓
[マイ服棚] ←→ [メイン画面]
    ↓
[色追加モーダル]
```

## 6. カラーパレットの提案

### 基本色（プリセット）
- **無彩色**: 白、グレー、黒、ベージュ
- **暖色系**: 赤、オレンジ、ピンク、コーラル
- **寒色系**: 青、水色、ネイビー、ターコイズ
- **中性色**: 緑、カーキ、オリーブ
- **その他**: 紫、イエロー、ゴールド

### カテゴリ別の推奨色数
- トップス: 10-15色
- ボトムス: 5-8色
- アウター: 5-10色
- 小物: 5-10色

## 7. 天気API連携の詳細仕様

### 7.1 OpenWeather APIの設定
- **APIキーの取得**
  - https://openweathermap.org/api でアカウント作成
  - Freeプランで十分（1分間に60リクエストまで）
- **APIエンドポイント**
  - 現在の天気: `https://api.openweathermap.org/data/2.5/weather`
  - パラメータ: `q`（都市名）、`appid`（APIキー）、`units=metric`（摂氏で取得）
- **レスポンス例**
```json
{
  "main": {
    "temp": 15.5,
    "temp_max": 18.0,
    "temp_min": 12.0
  },
  "weather": [{
    "main": "Clear",
    "description": "clear sky",
    "icon": "01d"
  }],
  "name": "Osaka"
}
```

### 7.2 実装方法の選択肢

#### 方法1: サーバーレス関数（推奨）
- **メリット**: サーバー管理不要、スケーラブル、無料枠あり
- **実装例**: Vercel Functions、Netlify Functions
- **コード例**:
```javascript
// api/weather.js (Vercel Functions)
export default async function handler(req, res) {
  const { city } = req.query;
  const apiKey = process.env.OPENWEATHER_API_KEY;
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
  
  const response = await fetch(url);
  const data = await response.json();
  
  res.json({
    temp: data.main.temp,
    tempMax: data.main.temp_max,
    tempMin: data.main.temp_min,
    description: data.weather[0].description,
    icon: data.weather[0].icon
  });
}
```

#### 方法2: 簡易バックエンド
- **メリット**: 柔軟性が高い、カスタマイズしやすい
- **実装例**: Python Flask、Node.js Express
- **注意**: CORS設定が必要

#### 方法3: フロントエンド直接呼び出し（非推奨）
- **デメリット**: APIキーが露出するためセキュリティリスクあり
- **用途**: プロトタイプや開発時のみ

### 7.3 エラーハンドリング
- API取得失敗時: 手動入力にフォールバック、エラーメッセージ表示
- 位置情報取得拒否時: 都市名入力フォームを表示
- ネットワークエラー時: キャッシュされた天気情報を表示（あれば）

